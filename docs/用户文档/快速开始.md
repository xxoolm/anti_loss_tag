# 快速开始

本指南将帮助您快速安装和配置 Home Assistant BLE 防丢标签集成。

## 前置要求

### 硬件要求
- BLE 防丢标签设备（支持 KT6368A 芯片或兼容设备）
- 蓝牙 USB 适配器（如果主机没有内置蓝牙）

### 软件要求
- Home Assistant >= 2024.1.0
- Python >= 3.11
- bleak >= 0.21.0
- bleak-retry-connector >= 3.0.0

### 蓝牙适配器要求
推荐使用支持蓝牙 5.0+ 的适配器，兼容性更好。

## 安装方法

### 方法1：通过 HACS 安装（推荐）

1. 在 Home Assistant 中打开 HACS
2. 点击"商店"
3. 搜索"anti_loss_tag"
4. 点击下载并安装
5. 重启 Home Assistant

### 方法2：手动安装

1. 创建目录：
```bash
cd /path/to/homeassistant/config
mkdir -p custom_components/anti_loss_tag
```

2. 下载集成文件：
```bash
cd custom_components/anti_loss_tag
# 复制集成的所有文件到此目录
```

3. 文件清单：
- `__init__.py` - 集成入口
- `manifest.json` - 集成清单
- `config_flow.py` - 配置流程
- `device.py` - 设备管理
- `sensor.py` - 传感器实体
- `binary_sensor.py` - 二进制传感器实体
- `button.py` - 按钮实体

4. 重启 Home Assistant

## 首次配置

### 1. 添加集成

1. 在 Home Assistant 中，进入"设置" → "设备与服务"
2. 点击"添加集成"
3. 搜索"BLE 防丢标签"或"anti_loss_tag"
4. 点击添加

### 2. 扫描设备

1. 集成会自动扫描附近的 BLE 设备
2. 在扫描到的设备列表中选择您的防丢标签
3. 设备名称通常格式为"Tag_XXXXXX"（XXXXXX为MAC地址后6位）

### 3. 配置参数

配置向导会提示您设置以下参数：

#### 必需参数
- **设备名称**：给设备起一个易识别的名称（如"我的钥匙"）

#### 可选参数
- **维持连接**：是否保持与设备的持续连接
  - 默认：关闭
  - 推荐：开启（用于实时监控）

- **电量轮询间隔（分钟）**：多久查询一次电量
  - 范围：5-10080 分钟
  - 默认：60 分钟
  - 推荐：120 分钟（平衡性能和准确性）

- **RSSI 轮询间隔（分钟）**：多久查询一次信号强度
  - 范围：1-60 分钟
  - 默认：5 分钟
  - 推荐：5 分钟

- **RSSI 阈值（dBm）**：信号低于此值时视为远离
  - 范围：-100 到 -50
  - 默认：-80
  - 推荐：-80（约5米距离）

- **远离超时（秒）**：信号弱持续多久后触发远离报警
  - 范围：5-120 秒
  - 默认：30 秒
  - 推荐：30 秒

### 4. 完成配置

1. 点击"提交"保存配置
2. 集成会自动连接到设备
3. 设备添加成功后，会创建以下实体：
   - 传感器：设备名称（电量、RSSI、连接状态等）
   - 二进制传感器：远离检测、断开检测
   - 按钮：按钮事件
   - 事件：设备事件

## 验证安装

### 检查实体

在 Home Assistant 中进入"开发者工具" → "状态"，搜索以下实体：

- `sensor.设备名称_battery` - 电量传感器
- `sensor.设备名称_rssi` - 信号强度
- `binary_sensor.设备名称_far_away` - 远离检测
- `binary_sensor.设备名称_connected` - 连接状态

### 测试连接

1. 查看连接状态：应该显示"已连接"
2. 查看电量：应该显示电量百分比
3. 测试按钮：双击设备上的按钮，应该在 Home Assistant 中看到事件

## 常见问题

### 找不到设备

**可能原因**：
- 设备未开启
- 蓝牙未启用
- 设备距离太远

**解决方法**：
1. 确保设备已开启并在附近
2. 检查 Home Assistant 的蓝牙适配器是否工作
3. 尝试重启蓝牙适配器或 Home Assistant

### 连接失败

**可能原因**：
- 设备被其他应用占用
- 蓝牙适配器不兼容
- 信号太弱

**解决方法**：
1. 关闭其他可能使用蓝牙的应用
2. 尝试更换蓝牙适配器
3. 将设备靠近适配器

### 电量不准确

**可能原因**：
- 设备刚连接，电量还未读取
- 电量轮询间隔设置过长

**解决方法**：
1. 等待几分钟后再查看
2. 调整电量轮询间隔到更小的值

## 下一步

配置完成后，您可以：

- 查看 [配置指南](configuration.md) 了解所有配置参数
- 阅读 [自动化示例](automation.md) 创建自动化场景
- 了解 [故障排除](troubleshooting.md) 解决常见问题

## 技术支持

如果遇到问题：

1. 查看 [故障排除](troubleshooting.md) 文档
2. 检查 Home Assistant 日志（设置 → 系统 → 日志）
3. 在 GitHub 提交 Issue：[项目地址]

---

**下一步**：[配置指南](configuration.md) | [自动化示例](automation.md)
