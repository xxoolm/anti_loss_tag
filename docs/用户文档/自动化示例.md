# è‡ªåŠ¨åŒ–ç¤ºä¾‹

æœ¬æ–‡æ¡£æä¾›å¸¸è§çš„è‡ªåŠ¨åŒ–åœºæ™¯å’Œç¤ºä¾‹ä»£ç ï¼Œå¸®åŠ©æ‚¨å……åˆ†åˆ©ç”¨ BLE é˜²ä¸¢æ ‡ç­¾é›†æˆã€‚

## ç›®å½•

- [åŸºç¡€è‡ªåŠ¨åŒ–](#åŸºç¡€è‡ªåŠ¨åŒ–)
  - [è¿œç¦»é€šçŸ¥](#è¿œç¦»é€šçŸ¥)
  - [ç”µé‡æé†’](#ç”µé‡æé†’)
  - [è¿æ¥çŠ¶æ€ç›‘æ§](#è¿æ¥çŠ¶æ€ç›‘æ§)
- [æŒ‰é’®äº‹ä»¶è‡ªåŠ¨åŒ–](#æŒ‰é’®äº‹ä»¶è‡ªåŠ¨åŒ–)
  - [åŒå‡»å¼€ç¯](#åŒå‡»å¼€ç¯)
  - [å•å‡»è§¦å‘åœºæ™¯](#å•å‡»è§¦å‘åœºæ™¯)
  - [é•¿æŒ‰ç´§æ€¥æ±‚åŠ©](#é•¿æŒ‰ç´§æ€¥æ±‚åŠ©)
- [é«˜çº§åœºæ™¯](#é«˜çº§åœºæ™¯)
  - [å¤šè®¾å¤‡è”åŠ¨](#å¤šè®¾å¤‡è”åŠ¨)
  - [ä½ç½®æ„ŸçŸ¥](#ä½ç½®æ„ŸçŸ¥)
  - [æ™ºèƒ½å‹¿æ‰°](#æ™ºèƒ½å‹¿æ‰°)
- [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)

---

## åŸºç¡€è‡ªåŠ¨åŒ–

### è¿œç¦»é€šçŸ¥

å½“æ ‡ç­¾è¿œç¦»æ—¶å‘é€æ‰‹æœºé€šçŸ¥ã€‚

```yaml
automation:
  - alias: "æ ‡ç­¾è¿œç¦»æé†’"
    id: "tag_far_away_notification"
    trigger:
      - platform: state
        entity_id: binary_sensor.my_tag_far_away
        to: "on"
    condition:
      - condition: state
        entity_id: input_boolean.home_mode
        state: "on"  # ä»…åœ¨å®¶æ¨¡å¼ä¸‹å‘Šè­¦
    action:
      - service: notify.mobile_app_my_phone
        data:
          title: "é˜²ä¸¢æé†’"
          message: "æ ‡ç­¾ 'æˆ‘çš„é’¥åŒ™' å·²è¿œç¦»ï¼"
          data:
            push:
              sound: default
              badge: 5
```

**æ‰©å±•**ï¼šæ·»åŠ è¯­éŸ³æ’­æŠ¥

```yaml
action:
  - service: notify.mobile_app_my_phone
    data:
      message: "æ ‡ç­¾å·²è¿œç¦»"
  - service: tts.google_translate_say
    target:
      entity_id: media_player.living_room_speaker
    data:
      message: "æ³¨æ„ï¼Œæ‚¨çš„é’¥åŒ™å¯èƒ½å·²ç¦»å¼€å½“å‰åŒºåŸŸ"
```

---

### ç”µé‡æé†’

å½“æ ‡ç­¾ç”µé‡ä½äº20%æ—¶å‘é€æé†’ã€‚

```yaml
automation:
  - alias: "æ ‡ç­¾ç”µé‡ä½æé†’"
    id: "tag_low_battery_notification"
    trigger:
      - platform: numeric_state
        entity_id: sensor.my_tag_battery
        below: 20
    action:
      - service: notify.mobile_app_my_phone
        data:
          title: "æ ‡ç­¾ç”µé‡ä½"
          message: "æ ‡ç­¾ 'æˆ‘çš„é’¥åŒ™' ç”µé‡ä»…å‰© {{ states('sensor.my_tag_battery') }}%ï¼Œè¯·åŠæ—¶å……ç”µï¼"
```

**æ‰©å±•**ï¼šå¤šçº§ç”µé‡æé†’

```yaml
automation:
  - alias: "æ ‡ç­¾ä¸¥é‡ç”µé‡å‘Šè­¦"
    trigger:
      - platform: numeric_state
        entity_id: sensor.my_tag_battery
        below: 10
    action:
      - service: notify.mobile_app_my_phone
        data:
          title: "âš ï¸ æ ‡ç­¾ç”µé‡ä¸¥é‡ä¸è¶³"
          message: "ç”µé‡ä»…å‰© {{ states('sensor.my_tag_battery') }}%ï¼Œè¯·ç«‹å³å……ç”µï¼"
          data:
            push:
              sound: alarm
              priority: high
```

---

### è¿æ¥çŠ¶æ€ç›‘æ§

ç›‘æ§è®¾å¤‡è¿æ¥çŠ¶æ€ï¼Œå¼‚å¸¸æ—¶é€šçŸ¥ã€‚

```yaml
automation:
  - alias: "æ ‡ç­¾æ–­å¼€è¿æ¥å‘Šè­¦"
    trigger:
      - platform: state
        entity_id: binary_sensor.my_tag_connected
        to: "off"
        for:
          minutes: 5
    condition:
      - condition: state
        entity_id: input_boolean.someone_home
        state: "on"
    action:
      - service: notify.mobile_app_my_phone
        data:
          title: "æ ‡ç­¾è¿æ¥ä¸­æ–­"
          message: "æ ‡ç­¾ 'æˆ‘çš„é’¥åŒ™' å·²æ–­å¼€è¿æ¥è¶…è¿‡5åˆ†é’Ÿ"
```

---

## æŒ‰é’®äº‹ä»¶è‡ªåŠ¨åŒ–

### åŒå‡»å¼€ç¯

åŒå‡»æ ‡ç­¾æŒ‰é’®æ‰“å¼€å®¢å…ç¯ã€‚

```yaml
automation:
  - alias: "åŒå‡»æ ‡ç­¾æ‰“å¼€å®¢å…ç¯"
    id: "double_click_turn_on_living_room_light"
    trigger:
      - platform: event
        event_type: anti_loss_tag_button_event
        event_data:
          device_id: "AA:BB:CC:DD:EE:FF"  # æ›¿æ¢ä¸ºä½ çš„è®¾å¤‡MAC
          click_type: double_click
    action:
      - service: light.turn_on
        target:
          entity_id: light.living_room
        data:
          brightness_pct: 80
```

**æ‰©å±•**ï¼šåˆ‡æ¢ç¯ï¼ˆå¦‚æœå¼€ç€å°±å…³ï¼Œå…³ç€å°±å¼€ï¼‰

```yaml
action:
  - service: light.toggle
    target:
      entity_id: light.living_room
```

---

### å•å‡»è§¦å‘åœºæ™¯

å•å‡»æ ‡ç­¾æ¿€æ´»"å›å®¶æ¨¡å¼"åœºæ™¯ã€‚

```yaml
automation:
  - alias: "å•å‡»æ ‡ç­¾æ¿€æ´»å›å®¶æ¨¡å¼"
    id: "single_click_activate_home_mode"
    trigger:
      - platform: event
        event_type: anti_loss_tag_button_event
        event_data:
          device_id: "AA:BB:CC:DD:EE:FF"
          click_type: single_click
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.home_mode
      - service: notify.mobile_app_my_phone
        data:
          message: "æ¬¢è¿å›å®¶ï¼åœºæ™¯å·²æ¿€æ´»"
```

---

### é•¿æŒ‰ç´§æ€¥æ±‚åŠ©

é•¿æŒ‰æ ‡ç­¾è§¦å‘ç´§æ€¥æ±‚åŠ©æ¨¡å¼ã€‚

```yaml
automation:
  - alias: "é•¿æŒ‰æ ‡ç­¾ç´§æ€¥æ±‚åŠ©"
    id: "long_press_emergency"
    trigger:
      - platform: event
        event_type: anti_loss_tag_button_event
        event_data:
          device_id: "AA:BB:CC:DD:EE:FF"
          click_type: long_press
    action:
      - service: script.turn_on
        target:
          entity_id: script.emergency_protocol
      - service: notify.notify_all_devices
        data:
          title: "ğŸ†˜ ç´§æ€¥æ±‚åŠ©"
          message: "æ£€æµ‹åˆ°ç´§æ€¥æ±‚åŠ©ä¿¡å·ï¼ä½ç½®ï¼š{{ states('sensor.device_tracker_iphone') }}"
          data:
            push:
              sound: alarm
              priority: high
```

---

## é«˜çº§åœºæ™¯

### å¤šè®¾å¤‡è”åŠ¨

å½“é’±åŒ…å’Œé’¥åŒ™åŒæ—¶è¿œç¦»æ—¶è§¦å‘å‘Šè­¦ã€‚

```yaml
automation:
  - alias: "é’±åŒ…å’Œé’¥åŒ™åŒæ—¶è¿œç¦»"
    trigger:
      - platform: template
        value_template: >
          {{ is_state('binary_sensor.wallet_far_away', 'on')
             and is_state('binary_sensor.keys_far_away', 'on') }}
    condition:
      - condition: state
        entity_id: input_boolean.security_mode
        state: "on"
    action:
      - service: notify.mobile_app_my_phone
        data:
          title: "å®‰å…¨å‘Šè­¦"
          message: "æ‚¨çš„é’±åŒ…å’Œé’¥åŒ™åŒæ—¶è¿œç¦»äº†ï¼"
          data:
            push:
              sound: alarm
              priority: high
```

---

### ä½ç½®æ„ŸçŸ¥

æ ¹æ®æ ‡ç­¾ä½ç½®è‡ªåŠ¨è°ƒæ•´æ™ºèƒ½å®¶å±…è®¾ç½®ã€‚

```yaml
automation:
  - alias: "æ ‡ç­¾é è¿‘æ—¶è°ƒæ•´å®¤å†…ç¯å¢ƒ"
    trigger:
      - platform: state
        entity_id: binary_sensor.my_tag_far_away
        to: "off"
    action:
      - service: climate.set_temperature
        target:
          entity_id: climate.living_room
        data:
          temperature: 24
      - service: light.turn_on
        target:
          entity_id: light.welcome_lights
      - service: notify.mobile_app_my_phone
        data:
          message: "æ¬¢è¿å›å®¶ï¼Œç¯å¢ƒå·²è°ƒæ•´"
```

---

### æ™ºèƒ½å‹¿æ‰°

å¤œé—´æˆ–ä¼‘æ¯æ—¶æ®µä¸è§¦å‘è¿œç¦»å‘Šè­¦ã€‚

```yaml
automation:
  - alias: "æ ‡ç­¾è¿œç¦»æé†’ï¼ˆæ™ºèƒ½å‹¿æ‰°ï¼‰"
    trigger:
      - platform: state
        entity_id: binary_sensor.my_tag_far_away
        to: "on"
    condition:
      - condition: time
        after: "08:00:00"
        before: "22:00:00"
      - condition: state
        entity_id: input_boolean.sleep_mode
        state: "off"
    action:
      - service: notify.mobile_app_my_phone
        data:
          title: "æ ‡ç­¾è¿œç¦»"
          message: "æ ‡ç­¾å·²è¶…å‡ºèŒƒå›´"
```

---

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹æŒ‰é’®äº‹ä»¶

åœ¨è‡ªåŠ¨åŒ–ä¸­æ·»åŠ æ—¥å¿—è®°å½•ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼š

```yaml
automation:
  - alias: "è°ƒè¯•æŒ‰é’®äº‹ä»¶"
    trigger:
      - platform: event
        event_type: anti_loss_tag_button_event
    action:
      - service: logbook.log
        data:
          name: "Tag Button Event"
          message: >
            è®¾å¤‡: {{ trigger.event.data.device_id }},
            ç±»å‹: {{ trigger.event.data.click_type }},
            æ—¶é—´: {{ now().strftime('%Y-%m-%d %H:%M:%S') }}
```

### æŸ¥çœ‹æ‰€æœ‰äº‹ä»¶

åœ¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹äº‹ä»¶ï¼š

1. è¿›å…¥"å¼€å‘è€…å·¥å…·" â†’ "äº‹ä»¶"
2. åœ¨"ç›‘å¬äº‹ä»¶"ä¸­è¾“å…¥ï¼š`anti_loss_tag_button_event`
3. æ“ä½œæ ‡ç­¾æŒ‰é’®
4. æŸ¥çœ‹äº‹ä»¶è¯¦æƒ…

---

## å®Œæ•´ç¤ºä¾‹é…ç½®

```yaml
# configuration.yaml

automation:
  # ========== åŸºç¡€è‡ªåŠ¨åŒ– ==========
  - alias: "æ ‡ç­¾è¿œç¦»é€šçŸ¥"
    trigger:
      - platform: state
        entity_id: binary_sensor.my_tag_far_away
        to: "on"
    action:
      - service: notify.mobile_app_my_phone
        data:
          message: "æ ‡ç­¾å·²è¿œç¦»"

  - alias: "æ ‡ç­¾ç”µé‡ä½æé†’"
    trigger:
      - platform: numeric_state
        entity_id: sensor.my_tag_battery
        below: 20
    action:
      - service: notify.mobile_app_my_phone
        data:
          title: "ç”µé‡ä½"
          message: "æ ‡ç­¾ç”µé‡ä»…å‰© {{ states('sensor.my_tag_battery') }}%"

  # ========== æŒ‰é’®äº‹ä»¶ ==========
  - alias: "åŒå‡»å¼€ç¯"
    trigger:
      - platform: event
        event_type: anti_loss_tag_button_event
        event_data:
          device_id: "AA:BB:CC:DD:EE:FF"
          click_type: double_click
    action:
      - service: light.toggle
        target:
          entity_id: light.living_room

  - alias: "å•å‡»æ¿€æ´»åœºæ™¯"
    trigger:
      - platform: event
        event_type: anti_loss_tag_button_event
        event_data:
          device_id: "AA:BB:CC:DD:EE:FF"
          click_type: single_click
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.relax_mode

  - alias: "é•¿æŒ‰ç´§æ€¥æ±‚åŠ©"
    trigger:
      - platform: event
        event_type: anti_loss_tag_button_event
        event_data:
          device_id: "AA:BB:CC:DD:EE:FF"
          click_type: long_press
    action:
      - service: script.emergency
```

---

**ä¸‹ä¸€æ­¥**ï¼š[æ•…éšœæ’é™¤](troubleshooting.md) | [è¿”å›ç”¨æˆ·æ–‡æ¡£](index.md)
