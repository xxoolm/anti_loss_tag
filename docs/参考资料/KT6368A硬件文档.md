# KT6368A 硬件开发文档

> **KT6368A 芯片硬件设计参考**

## 一、芯片定位

- **类型**：Bluetooth 双模数据芯片（BLE + SPP）
- **协议**：Bluetooth V5.x
- **典型用法**：UART 透传 + AT 配置
- **应用场景**：串口蓝牙透传模块、低功耗外设、简单人机交互

## 二、供电规格

### 2.1 电压范围

- **推荐电压**：3.3V
- **工作范围**：2.2V - 3.4V
- **最大电压**：不要超过 3.6V

### 2.2 电流特性

- **启动瞬态**：约 26mA（约1秒后降到4mA）
- **低功耗模式**：几十 µA 级（典型 20µA）
- **未连接维持**：低功耗模式

### 2.3 去耦电容

- VBAT 就近放置：**0.1µF + 1µF**
- 若有蜂鸣器/LED等瞬态负载：建议加 4.7-10µF 储能电容

## 三、引脚定义（SOP-8）

| 引脚 | 名称       | 功能说明                     |
| ---- | ---------- | ---------------------------- |
| 1    | VBAT/VDDIO | 电源（2.2-3.4V）             |
| 2    | PB1        | GPIO/蜂鸣器/控制脚           |
| 3    | VSS        | GND                          |
| 4    | BT_RF      | 射频单端天线脚               |
| 5    | BTOSCI     | 高频晶振输入                 |
| 6    | BTOSCO     | 高频晶振输出                 |
| 7    | USBDM      | GPIO/UART/LED（可复用）      |
| 8    | USBDP      | GPIO/UART/按键（可复用）     |

## 四、时钟设计

### 4.1 晶体要求

- **连接位置**：Pin5（BTOSCI）和 Pin6（BTOSCO）
- **布局要求**：
  - 晶体靠近芯片（走线极短、对称、等长）
  - 周围不要走高噪声线
- **负载电容**：8-12pF（按晶体规格书，需结合PCB寄生）

### 4.2 地参考

- 负载电容回地就近打过孔
- 避免与蜂鸣器/LED回流共享长地线

## 五、射频与天线

### 5.1 BT_RF 引脚（Pin4）

- **类型**：单端天线输出
- **匹配网络**：常见使用 2.7pF（实作常用 0Ω 代替）
- **量产建议**：预留可调位置

### 5.2 RF 布局要点

1. **Pin4 到天线走线尽量短**
2. **保持连续参考地**
3. **避免穿越分割地**
4. **天线附近 keep-out**：不要铺地或放置金属/电池
5. **预留匹配网络焊盘**（即使初版不装）

## 六、IO 控制与低功耗

### 6.1 IO 复用

PB1（Pin2）与 Pin7/Pin8 可承担：
- GPIO
- 串口
- USB
- 状态指示

**典型应用**：
- **蜂鸣器**：PB1 输出 PWM/方波，或驱动外置三极管
- **LED**：IO + 限流电阻（建议 1-5mA）
- **按键**：IO 输入 + 上拉（内部/外部）

### 6.2 低功耗模式（关键）

**重要特性**：进入低功耗后**所有 IO 口为高阻态**

**硬件要求**：
- 不要让关键控制对象依赖"IO 默认电平"
- 蜂鸣器/LED/开关管的栅极/基极建议加**硬件上拉/下拉**
- 确保低功耗时处于"确定的安全态"

**示例**：蜂鸣器默认关断，防止误响

## 七、串口与调试

### 7.1 UART（AT 配置）

- **默认波特率**：115200
- **用途**：产测写参数、老化测试、问题定位

**硬件建议**：
- 预留 UART 测试点（TX/RX/GND/VBAT）
- 串口电平按 VBAT/VDDIO（通常 3.3V）

### 7.2 低功耗下 AT 有效窗口

- 上电前几秒可识别
- 影响产线流程设计

### 7.3 BLE 地址与 SPP 地址

- SPP 地址 = BLE 地址高字节 +1
- 量产通常只需要写 BLE 地址

## 八、固件升级接口

### 8.1 Pin7/Pin8 硬件策略

虽然标为 USBDM/USBDP，但在不同场景会被用作**下载/升级**或复用为 IO/UART。

**硬件建议**：
1. **强烈建议预留测试点/焊盘**
2. 若外接 LED/按键，通过电阻/可断开设计
3. 确保升级时不被外部电路强拉电平或注入噪声

### 8.2 产线升级

- 按厂商/方案提供的下载工具与流程设计夹具
- 资料：测试板说明/方案手册

## 九、参考设计

### 9.1 最小系统（BLE/SPP 透传）

- VBAT：2.2-3.4V
- 去耦：0.1µF + 1µF（就近）
- 晶体：连接 Pin5/6，配负载电容
- 天线：Pin4 → 匹配预留（0Ω/2.7pF）→ PCB 天线
- UART：TX/RX 测试点用于 AT 配置
- IO：PB1/Pin7/Pin8 用于 LED/按键/蜂鸣器

### 9.2 纽扣电池反丢/蜂鸣器版本

- **蜂鸣器**：IO → 驱动管 → 蜂鸣器（减少IO直驱电流压力）
- **LED**：IO → 限流电阻 → LED
- **按键**：IO 输入 + 上拉（外部 100k 级可降漏电）

## 十、产测验证清单

### 10.1 供电边界

- 测试 2.2-3.4V 范围
- 确认不要超过 3.6V

### 10.2 晶体起振/频偏

- 上电广播稳定，连接不掉线
- 异常时优先排查晶体布局、负载电容

### 10.3 RF 性能

- 不同装配状态（装电池/装外壳/手持）RSSI 与距离一致性
- 必要时通过匹配位微调（2.7pF/0Ω替换）

### 10.4 低功耗

- 验证 IO 高阻引起的误触发风险
- 蜂鸣器误响、LED 漏亮、按键漂移
- 用外部上拉/下拉修正

### 10.5 AT 产线流程

- 默认波特率 115200
- AT 参数写入与保存
- 地址写入策略

## 十一、资料索引

- **KT6368A Datasheet**：引脚、RF/晶体、总体规格
- **KT6368A Chip User Manual**：双模、状态查询、使用/调试
- **KT6368A AT Command**：低功耗、地址规则、AT 行为细节
- **KT6368A Test Board/SMT Notes**：天线匹配、供电上限等工程经验
- **BLE 标准原理图/参考电路**：晶体与电源/接口的参考连法

## 十二、常见问题

**Q: 为什么低功耗时蜂鸣器误响？**

A: 低功耗模式所有IO为高阻态，蜂鸣器控制脚可能漂移。解决：加硬件下拉，确保默认关断。

---

**Q: 天线匹配位用 0Ω 还是 2.7pF？**

A: 开发用 0Ω 即可，量产预留 2.7pF 位置用于调优。

---

**Q: Pin7/Pin8 能直接接 LED/按键吗？**

A: 可以，但建议通过电阻/可断开设计，保留固件升级接口。

---

**Q: 为什么扫描不到设备？**

A: 检查：
1. 供电是否正常（2.2-3.4V）
2. 晶体是否起振
3. 天线匹配是否正确
4. RSSI 是否正常（-60dBm 左右）

---

**相关文档**：
- **固件文档**：`docs/参考资料/KT6368A固件文档.md`
- **BLE 协议**：`docs/技术文档/BLE协议规范.md`
- **架构设计**：`docs/技术文档/系统架构设计.md`
